generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. Configuración del Sistema 
model LicenseCategory {
  id       Int       @id @default(autoincrement())
  name     String    @unique // Ej: A2, B1, C1
  subjects Subject[] // Relación muchos a muchos (Qué materias ve esta licencia)
  students Student[]
}

model Subject {
  id           Int               @id @default(autoincrement())
  name         String            @unique // Ej: "Mecánica Básica", "Ética"
  description  String?
  is_practical Boolean           @default(false) // Para diferenciar teoría de práctica si es necesario
  categories   LicenseCategory[] // A qué licencias aplica esta materia
  classes      Class[]
}

// 2. Usuarios y Roles
model Role {
  id          Int     @id @default(autoincrement())
  name        String  @unique // ADMIN, PROFESSOR, STUDENT
  description String?
  users       User[]
}

model User {
  id            Int        @id @default(autoincrement())
  email         String     @unique
  password_hash String
  full_name     String
  role_id       Int
  role          Role       @relation(fields: [role_id], references: [id])
  student       Student?
  professor     Professor?
}

model Student {
  id                  Int              @id @default(autoincrement())
  user_id             Int              @unique
  user                User             @relation(fields: [user_id], references: [id])
  license_category_id Int? // El estudiante pertenece a una categoría (A2, B1...)
  license_category    LicenseCategory? @relation(fields: [license_category_id], references: [id])
  reservations        Reservation[]
}

model Professor {
  id      Int     @id @default(autoincrement())
  user_id Int     @unique
  user    User    @relation(fields: [user_id], references: [id])
  classes Class[]
}

model WeeklySchedule {
  id         Int      @id @default(autoincrement())
  name       String // Ej: "Semana 2 - Enero 2026"
  start_date DateTime // 2026-01-05
  end_date   DateTime // 2026-01-11
  is_active  Boolean  @default(false) // <-- Para ocultarla hasta que esté lista
  classes    Class[] // Relación: Una semana tiene muchas clases
}

// 3. Programación de Clases 
model Class {
  id         Int     @id @default(autoincrement())
  // title           String?  <-- ELIMINADO: Ya no escribimos títulos a mano
  subject_id Int
  subject    Subject @relation(fields: [subject_id], references: [id])

  class_date DateTime @db.Date
  start_time DateTime @db.Time
  end_time   DateTime @db.Time

  max_capacity       Int
  available_capacity Int

  professor_id Int
  professor    Professor @relation(fields: [professor_id], references: [id])

  reservations       Reservation[]
  status             String          @default("OPEN")
  weekly_schedule_id Int?
  weekly_schedule    WeeklySchedule? @relation(fields: [weekly_schedule_id], references: [id])
}

model Reservation {
  id         Int      @id @default(autoincrement())
  status     String   @default("ACTIVE")
  student_id Int
  student    Student  @relation(fields: [student_id], references: [id])
  class_id   Int
  class      Class    @relation(fields: [class_id], references: [id])
  created_at DateTime @default(now())
}
